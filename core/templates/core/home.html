{% extends "core/base.html" %}
{% block title %}Inicio — Sistema Audiología{% endblock %}

{% block content %}
<div class="row g-4">

  <!-- Columna izquierda: Acciones / Resumen -->
  <div class="col-12 col-lg-4">
    <!-- Resumen mini -->
    <div class="card mb-4">
      <div class="card-header py-3">
        <div class="d-flex align-items-center justify-content-between">
          <h5 class="section-title mb-0"><i class="bi bi-speedometer2 me-2"></i>Panel rápido</h5>
          <span class="pill"><i class="bi bi-heart-pulse"></i> Audiología</span>
        </div>
        <div class="section-sub mt-1">Atajos para el flujo diario de atención.</div>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <a href="{% url 'patient_create' %}" class="btn btn-brand">
            <i class="bi bi-person-plus me-1"></i> Nuevo Paciente
          </a>
          <a href="{% url 'patient_list' %}" class="btn btn-outline-brand">
            <i class="bi bi-people me-1"></i> Buscar/Listar Pacientes
          </a>
        </div>

        <hr class="my-4">

        <!-- Tips/ayuda (no requiere datos nuevos) -->
        <div class="d-flex align-items-start gap-3">
          <div class="text-white rounded-3 p-2" style="background:linear-gradient(135deg,var(--brand-600),var(--teal-500)); box-shadow:0 10px 18px rgba(47,149,255,.25);">
            <i class="bi bi-ear"></i>
          </div>
          <div class="small text-secondary">
            <div class="fw-semibold text-dark mb-1">Consejo</div>
            Mantén los datos del paciente actualizados para agilizar la creación de exámenes y seguimiento.
          </div>
        </div>
      </div>
    </div>

    <!-- Tarjeta “Estado del día” (placeholder visual, sin lógica) -->
    <div class="card h-100">
      <div class="card-header py-3">
        <h5 class="section-title mb-0"><i class="bi bi-calendar-day me-2"></i>Estado del día</h5>
        <div class="section-sub mt-1">Resumen visual del flujo de hoy.</div>
      </div>
      <div class="card-body">
        <div class="d-flex flex-wrap gap-2">
          <span class="pill"><i class="bi bi-person-check"></i> Check-in</span>
          <span class="pill" style="background:#fff3cd;border-color:#ffe69c;color:#7a5b00;"><i class="bi bi-hourglass-split"></i> En espera</span>
          <span class="pill" style="background:#dcfce7;border-color:#bbf7d0;color:#166534;"><i class="bi bi-clipboard2-check"></i> Evaluados</span>
        </div>
        <div class="text-secondary small mt-3">
          Este bloque es puramente estético y puede conectarse más adelante a tus métricas diarias.
        </div>
      </div>
    </div>
  </div>

  <!-- Columna derecha: Pacientes recientes -->
  <div class="col-12 col-lg-8">
    <div class="card h-100">
      <div class="card-header py-3">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="section-title mb-0"><i class="bi bi-clock-history me-2"></i>Pacientes recientes</h5>
          <a class="small fw-semibold text-decoration-none" href="{% url 'patient_list' %}">
            Ver todos <i class="bi bi-arrow-right-short"></i>
          </a>
        </div>
        <div class="section-sub mt-1">Últimos pacientes que pasaron por recepción/consulta.</div>
      </div>
      <div class="card-body">

        <div class="table-responsive">
          <table class="table align-middle table-hover">
            <thead>
              <tr>
                <th><i class="bi bi-person-badge me-1"></i>RUT</th>
                <th><i class="bi bi-person me-1"></i>Nombre</th>
                <th><i class="bi bi-cake2 me-1"></i>Edad</th>
                <th class="text-end">Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for p in patients %}
              <tr>
                <td class="fw-semibold">{{ p.rut }}</td>
                <td>{{ p.last_name }}, {{ p.first_name }}</td>
                <td>
                  {% if p.birth_date %}
                    {% with age=p.age_on|default_if_none:"" %}{{ age }}{% endwith %}
                  {% else %}-{% endif %}
                </td>
                <td class="text-end">
                  <a class="btn btn-sm btn-outline-brand" href="{% url 'patient_detail' p.pk %}">
                    <i class="bi bi-arrow-up-right"></i> Abrir
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4">
                  <div class="text-center text-secondary py-4">
                    <div class="mb-2" style="font-size:1.6rem;">
                      <i class="bi bi-inboxes"></i>
                    </div>
                    <div class="fw-semibold">Sin pacientes aún.</div>
                    <div class="small">Crea tu primer paciente desde <span class="text-dark fw-semibold">Acciones rápidas</span>.</div>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</div>
{% endblock %}
